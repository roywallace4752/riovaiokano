name: Titan Simple Test

on:
  workflow_dispatch:

jobs:
  test:
    runs-on: ubuntu-latest
    steps:
      - name: Quick Test
        env:
          TITAN_KEY: ${{ secrets.TITAN_KEY }}
        run: |
          # نصب
          wget -q https://pcdn.titannet.io/test4/bin/agent-linux.zip
          mkdir -p ~/titan
          unzip -q agent-linux.zip -d ~/titan
          cd ~/titan
          chmod +x agent
          
          # اجرا (20 دقیقه)
          timeout 1200 ./agent \
            --working-dir=$HOME/titan \
            --server-url=https://test4-api.titannet.io \
            --key=${TITAN_KEY} \
            2>&1 | tee titan.log || true
          
          echo "=== Log Output ==="
          cat titan.log
